# Лабораторная работа № 16

Пример аномалии «Потерянное обновление» в SQLite:

```
code
```

Что здесь происходит?
•	Начальный баланс — 100.
•	Транзакция 1 читает баланс = 100, ждёт 2 секунды, затем записывает баланс + 50 = 150.
•	Транзакция 2 в это время читает тот же баланс = 100 (т.к. transaction1 ещё не сделала коммит), добавляет +100 и записывает 200.
•	Итог: обновление транзакции 1, которое добавляет +50, теряется, так как транзакция 2 переписывает значение, считанное до обновления transaction1.
Результат:
Transaction1: прочитал баланс 100
Transaction2: прочитал баланс 100
Transaction2: записал баланс 200
Transaction2: commit
Transaction1: записал баланс 150
Transaction1: commit
Итоговый баланс: 150
•	Вместо 250 (100 + 50 + 100) в базе — только 150.
•	Это и есть аномалия «Потерянное обновление».
Как избежать аномалии?
1. Использовать блокировки:
•	Явное блокирование записей (SELECT ... FOR UPDATE в СУБД, поддерживающих это).
•	В SQLite — использовать BEGIN EXCLUSIVE TRANSACTION для запрета доступа другим транзакциям.
2. Повысить уровень изоляции транзакций:
•	SERIALIZABLE (не все СУБД это поддерживают в полной мере).
3. Использовать оптимистичные блокировки:
•	Хранить версию записи и проверять, не изменена ли она при коммите.
4. Повторять транзакцию при конфликте:
•	Если обнаружено несоответствие, прервать и попробовать заново.

